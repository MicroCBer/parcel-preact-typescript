<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Parcel Preact Typescript</title>
</head>

<body>
  <div id="root"></div>
  <link rel="stylesheet" href="./index.scss">
  <script>

    const urlToStyleElementMap = new Map();
    setTimeout(() => {
      const linkElements = document.querySelectorAll('link[rel="stylesheet"]');
      linkElements.forEach((linkElement) => {
        const url = linkElement.getAttribute('href');
        const styleElement = document.createElement('style');
        linkElement.parentElement.appendChild(styleElement);
        linkElement.remove()
        urlToStyleElementMap.set(url, styleElement);
      });
    }, 100);

    async function updateStyles() {
      for (const [url, styleElement] of urlToStyleElementMap.entries()) {
        const response = await fetch(url + "?" + Math.random());
        if (response.status === 200) {
          const cssText = await response.text();
          const styleElement2 = document.createElement('style');
          styleElement2.innerHTML = cssText;
          styleElement.parentElement.appendChild(styleElement2);
          styleElement.remove()
          urlToStyleElementMap.set(url, styleElement2);
        }
        else {
          console.error(`Failed to fetch CSS from ${url}, status code: ${response.status}`);
        }
      }
    }

    console.clear = () => {
      console.log("------- Cleared --------")
      updateStyles()
    }


    location.reload = function () {
      console.log("location.reload");
      Window.this.load(location.href);
    };

    document.on("keyup", function (evt) {
      if (evt.code == "F5") {
        location.reload();
      }
    });
  </script>
  <script src="./index.tsx"></script>
</body>

</html>